# Fino 插件接口规范

任何人可按照此规范开发 Fino 插件，并上架至插件中心供用户安装。

## 1. 插件目录结构

```
plugins/
  your-plugin-id/
    __init__.py
    plugin.py
```

`plugin.py` 为入口文件，必须实现 `Plugin` 类。

## 2. 接口实现

### 2.1 继承 PluginInterface

```python
from app.plugins.interface import PluginInterface, PluginManifest

class Plugin(PluginInterface):
    def get_manifest(self) -> PluginManifest:
        return PluginManifest(
            id="your-plugin-id",        # 唯一标识
            name="插件显示名称",
            version="1.0.0",
            description="插件描述",
            author="作者名",
            nav_item={"id": "page-id", "label": "导航名", "icon": "material_icon"},
            settings_tab={"id": "tab-id", "label": "设置Tab", "icon": "icon"},
            floating_widget={"id": "widget-id", "label": "悬浮组件"},
        )

    def register(self, app) -> None:
        # 注册 Flask Blueprint、路由等
        app.register_blueprint(your_bp)

    def unregister(self, app) -> None:
        # 从应用移除
        if your_bp.name in app.blueprints:
            app.blueprints.pop(your_bp.name, None)
```

### 2.2 PluginManifest 字段说明

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | str | 是 | 唯一标识，建议用 `fino-xxx` 格式 |
| name | str | 是 | 插件显示名称 |
| version | str | 是 | 语义化版本 |
| description | str | 是 | 简短描述 |
| author | str | 是 | 作者 |
| nav_item | dict | 否 | 侧边栏入口，`{id, label, icon}` |
| settings_tab | dict | 否 | 设置页 Tab |
| floating_widget | dict | 否 | 悬浮组件（如 AI 按钮） |
| homepage | str | 否 | 项目主页 |
| repository | str | 否 | 代码仓库 |
| dependencies | list | 否 | 依赖的其他插件 id |

### 2.3 可选生命周期

```python
def install(self, app) -> None:
    """安装时：创建数据库表、初始化配置"""

def uninstall(self, app) -> None:
    """卸载时：清理数据"""

def on_enable(self, app) -> None:
    """启用时"""

def on_disable(self, app) -> None:
    """禁用时"""
```

## 3. 安装方式

1. **本地安装**：将插件目录放入项目的 `plugins/` 目录
2. **启用**：在设置 → 插件中心 中点击「启用」

## 4. 上架插件中心

在 `conf/plugin_registry.json` 中添加插件信息，或提交 PR 至官方注册表：

```json
{
  "plugins": [
    {
      "id": "your-plugin-id",
      "name": "插件名称",
      "version": "1.0.0",
      "description": "描述",
      "author": "作者",
      "download_url": "https://...",
      "install_type": "url"
    }
  ]
}
```

## 5. 内置插件示例

- `plugins/fino-ai-chat/` - AI 智能助手
- `plugins/fino-cloudreve/` - Cloudreve 网盘

参考以上目录可快速开发新插件。
