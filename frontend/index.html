<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投资追踪器</title>
    <link rel="stylesheet" href="/frontend/css/styles.css?v=2">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        #login-page, #register-page {
            background: radial-gradient(1200px 720px at 12% -12%, #fff8ec 0%, #f6f3ed 42%, #f1ede6 100%) !important;
            background-image: radial-gradient(1000px 620px at 85% 12%, rgba(251, 232, 196, 0.28), transparent 55%),
                              radial-gradient(1200px 800px at 30% 90%, rgba(197, 212, 255, 0.2), transparent 58%),
                              linear-gradient(135deg, rgba(255, 255, 255, 0.36) 0%, rgba(255, 255, 255, 0.06) 60%) !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="login-page" class="page active">
            <div class="login-container">
                <div class="login-card">
                    <div class="fino-logo">
                        <div class="logo-text">Fino</div>
                        <div class="logo-tagline">Investment</div>
                    </div>
                    <form id="login-form">
                        <div class="form-group">
                            <label for="username">用户名</label>
                            <input type="text" id="username" name="username" required placeholder="请输入用户名">
                        </div>
                        <div class="form-group">
                            <label for="password">密码</label>
                            <input type="password" id="password" name="password" required placeholder="请输入密码">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            登录
                        </button>
                        <div id="login-error" class="error-message"></div>
                    </form>
                    <div class="login-footer">
                        <p>还没有账号？<a href="#" id="show-register">立即注册</a></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="register-page" class="page">
            <div class="login-container">
                <div class="login-card">
                    <div class="fino-logo">
                        <div class="logo-text">Fino</div>
                        <div class="logo-tagline">Investment</div>
                    </div>
                    <form id="register-form">
                        <div class="form-group">
                            <label for="reg-email">邮箱</label>
                            <input type="email" id="reg-email" name="email" required placeholder="请输入邮箱">
                        </div>
                        <div class="form-group">
                            <label for="reg-username">用户名</label>
                            <input type="text" id="reg-username" name="username" required placeholder="请输入用户名">
                        </div>
                        <div class="form-group">
                            <label for="reg-password">密码</label>
                            <input type="password" id="reg-password" name="password" required placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="reg-password-confirm">确认密码</label>
                            <input type="password" id="reg-password-confirm" name="password_confirm" required placeholder="请再次输入密码">
                        </div>
                        <div class="form-group">
                            <label for="reg-password-hint">密码提示</label>
                            <input type="text" id="reg-password-hint" name="password_hint" placeholder="用于找回密码的提示">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            注册
                        </button>
                        <div id="register-error" class="error-message"></div>
                        <div id="register-success" class="success-message"></div>
                    </form>
                    <div class="login-footer">
                        <p>已有账号？<a href="#" id="show-login">返回登录</a></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="main-page" class="page">
            <nav class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="logo-small">
                        <span class="material-icons">trending_up</span>
                        <span>投资追踪器</span>
                    </div>
                </div>
                <div class="user-info">
                    <div class="user-avatar">
                        <span class="material-icons">person</span>
                    </div>
                    <div class="user-details">
                        <span class="user-name" id="user-name">用户名</span>
                        <span class="user-role">普通用户</span>
                    </div>
                </div>
                <ul class="nav-menu">
                    <li class="nav-item active" data-page="dashboard">
                        <span class="material-icons">dashboard</span>
                        <span>仪表盘</span>
                    </li>
                    <li class="nav-item" data-page="positions">
                        <span class="material-icons">account_balance</span>
                        <span>持仓管理</span>
                    </li>
                    <li class="nav-item" data-page="transactions">
                        <span class="material-icons">receipt_long</span>
                        <span>交易记录</span>
                    </li>
                    <li class="nav-item" data-page="funds">
                        <span class="material-icons">payments</span>
                        <span>资金明细</span>
                    </li>
                    <li class="nav-item" data-page="add-transaction">
                        <span class="material-icons">add_circle</span>
                        <span>添加交易</span>
                    </li>
                    <li class="nav-item" data-page="analysis">
                        <span class="material-icons">analytics</span>
                        <span>收益分析</span>
                    </li>
                    <li class="nav-item" data-page="settings">
                        <span class="material-icons">settings</span>
                        <span>设置</span>
                    </li>
                </ul>
                <div class="sidebar-footer">
                    <button id="logout-btn" class="btn btn-outline">
                        <span class="material-icons">logout</span>
                        退出登录
                    </button>
                </div>
            </nav>

            <main class="main-content">
                <header class="top-bar">
                    <button id="sidebar-toggle" class="btn-icon">
                        <span class="material-icons">menu</span>
                    </button>
                    <div class="page-title">
                        <h2 id="current-page-title">仪表盘</h2>
                    </div>
                    <div class="header-actions">
                        <select id="ledger-select" class="select-control">
                            <option value="">选择账本</option>
                        </select>
                        <select id="account-select" class="select-control">
                            <option value="">选择账户</option>
                        </select>
                    </div>
                </header>

                <div class="content-area">
                    <div id="dashboard-view" class="view active">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon blue">
                                    <span class="material-icons">payments</span>
                                </div>
                                <div class="stat-content">
                                    <span class="stat-label">总投入成本</span>
                                    <span class="stat-value" id="total-cost">¥0.00</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon green">
                                    <span class="material-icons">show_chart</span>
                                </div>
                                <div class="stat-content">
                                    <span class="stat-label">当前市值</span>
                                    <span class="stat-value" id="total-value">¥0.00</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" id="profit-icon">
                                    <span class="material-icons">trending_up</span>
                                </div>
                                <div class="stat-content">
                                    <span class="stat-label">总收益</span>
                                    <span class="stat-value" id="total-profit">¥0.00</span>
                                    <span class="stat-rate" id="profit-rate">0.00%</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon orange">
                                    <span class="material-icons">inventory_2</span>
                                </div>
                                <div class="stat-content">
                                    <span class="stat-label">持仓数量</span>
                                    <span class="stat-value" id="position-count">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="charts-grid">
                            <div class="chart-card">
                                <div class="card-header">
                                    <h3>资产配置</h3>
                                </div>
                                <div class="card-body">
                                    <div id="allocation-chart" class="chart-container">
                                        <div class="empty-state">
                                            <span class="material-icons">pie_chart</span>
                                            <p>暂无持仓数据</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-card">
                                <div class="card-header">
                                    <h3>持仓收益</h3>
                                </div>
                                <div class="card-body">
                                    <div id="profit-chart" class="chart-container">
                                        <div class="empty-state">
                                            <span class="material-icons">bar_chart</span>
                                            <p>暂无持仓数据</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-card">
                            <div class="card-header">
                                <h3>最近交易</h3>
                                <button class="btn btn-sm" onclick="app.navigateTo('transactions')">
                                    查看全部
                                    <span class="material-icons">arrow_forward</span>
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>日期</th>
                                                <th>类型</th>
                                                <th>代码</th>
                                                <th>名称</th>
                                                <th>价格</th>
                                                <th>数量</th>
                                                <th>金额</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recent-transactions">
                                            <tr>
                                                <td colspan="7" class="empty-message">暂无交易记录</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="positions-view" class="view">
                        <div class="data-card">
                            <div class="card-header">
                                <h3>持仓列表</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>代码</th>
                                                <th>名称</th>
                                                <th>持仓数量</th>
                                                <th>成本价</th>
                                                <th>当前价</th>
                                                <th>市值(CNY)</th>
                                                <th>收益</th>
                                                <th>收益率</th>
                                            </tr>
                                        </thead>
                                        <tbody id="positions-list">
                                            <tr>
                                                <td colspan="8" class="empty-message">暂无持仓数据</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="transactions-view" class="view">
                        <div class="toolbar">
                            <div class="toolbar-left">
                                <select id="trans-type-filter" class="select-control">
                                    <option value="">全部类型</option>
                                    <option value="买入">买入</option>
                                    <option value="卖出">卖出</option>
                                    <option value="分红">分红</option>
                                </select>
                                <input type="date" id="trans-start-date" class="date-control">
                                <span>至</span>
                                <input type="date" id="trans-end-date" class="date-control">
                                <button class="btn btn-primary" onclick="app.loadTransactions()">
                                    <span class="material-icons">search</span>
                                    查询
                                </button>
                            </div>
                            <div class="toolbar-right">
                                <button class="btn btn-success" onclick="app.showAddTransactionModal()">
                                    <span class="material-icons">add</span>
                                    添加交易
                                </button>
                            </div>
                        </div>
                        <div class="data-card">
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>日期</th>
                                                <th>类型</th>
                                                <th>代码</th>
                                                <th>名称</th>
                                                <th>价格</th>
                                                <th>数量</th>
                                                <th>金额</th>
                                                <th>手续费</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="transactions-list">
                                            <tr>
                                                <td colspan="9" class="empty-message">暂无交易记录</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="pagination" id="transactions-pagination"></div>
                            </div>
                        </div>
                    </div>

                    <div id="funds-view" class="view">
                        <div class="toolbar">
                            <div class="toolbar-left">
                                <select id="fund-type-filter" class="select-control">
                                    <option value="">全部类型</option>
                                    <option value="本金投入">本金投入</option>
                                    <option value="本金撤出">本金撤出</option>
                                    <option value="收入">收入</option>
                                    <option value="支出">支出</option>
                                    <option value="内转">内转</option>
                                </select>
                                <button class="btn btn-success" onclick="app.showAddFundModal()">
                                    <span class="material-icons">add</span>
                                    添加资金明细
                                </button>
                            </div>
                        </div>
                        <div class="data-card">
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>日期</th>
                                                <th>类型</th>
                                                <th>金额</th>
                                                <th>币种</th>
                                                <th>人民币金额</th>
                                                <th>描述</th>
                                            </tr>
                                        </thead>
                                        <tbody id="funds-list">
                                            <tr>
                                                <td colspan="6" class="empty-message">暂无资金明细</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="add-transaction-view" class="view">
                        <div class="form-card">
                            <div class="card-header">
                                <h3>添加交易记录</h3>
                            </div>
                            <div class="card-body">
                                <form id="transaction-form">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="trans-ledger">账本 *</label>
                                            <select id="trans-ledger" name="ledger_id" required>
                                                <option value="">选择账本</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="trans-account">账户 *</label>
                                            <select id="trans-account" name="account_id" required>
                                                <option value="">选择账户</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="trans-type">交易类型 *</label>
                                            <select id="trans-type" name="type" required>
                                                <option value="">选择类型</option>
                                                <option value="买入">买入</option>
                                                <option value="卖出">卖出</option>
                                                <option value="分红">分红</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="trans-date">交易日期 *</label>
                                            <input type="date" id="trans-date" name="date" required>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="trans-code">证券代码 *</label>
                                            <input type="text" id="trans-code" name="code" required placeholder="如: SH.600519">
                                        </div>
                                        <div class="form-group">
                                            <label for="trans-name">证券名称 *</label>
                                            <input type="text" id="trans-name" name="name" required placeholder="如: 贵州茅台">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="trans-price">价格 *</label>
                                            <input type="number" id="trans-price" name="price" step="0.01" required placeholder="0.00">
                                        </div>
                                        <div class="form-group">
                                            <label for="trans-quantity">数量 *</label>
                                            <input type="number" id="trans-quantity" name="quantity" step="0.01" required placeholder="0">
                                        </div>
                                        <div class="form-group">
                                            <label for="trans-amount">成交金额</label>
                                            <input type="number" id="trans-amount" name="amount" step="0.01" readonly>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="trans-fee">手续费</label>
                                            <input type="number" id="trans-fee" name="fee" step="0.01" value="0">
                                        </div>
                                        <div class="form-group">
                                            <label for="trans-category">类别</label>
                                            <select id="trans-category" name="category">
                                                <option value="">选择类别</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="trans-notes">备注</label>
                                        <textarea id="trans-notes" name="notes" rows="3" placeholder="添加备注..."></textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">
                                            <span class="material-icons">save</span>
                                            保存
                                        </button>
                                        <button type="reset" class="btn btn-outline">
                                            <span class="material-icons">clear</span>
                                            重置
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div id="analysis-view" class="view">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-content">
                                    <span class="stat-label">净值法累计收益率</span>
                                    <span class="stat-value" id="nav-return">0.00%</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-content">
                                    <span class="stat-label">简单收益率</span>
                                    <span class="stat-value" id="simple-return">0.00%</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="card-header">
                                <h3>收益率走势</h3>
                            </div>
                            <div class="card-body">
                                <div id="return-chart" class="chart-container">
                                    <div class="empty-state">
                                        <span class="material-icons">show_chart</span>
                                        <p>暂无收益数据</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="settings-view" class="view">
                        <div class="form-card">
                            <div class="card-header">
                                <h3>API 访问令牌</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label>Token 用于 API 调用（如脚本、第三方工具），退出登录和修改密码后仍有效</label>
                                    <div class="token-display">
                                        <input type="password" id="api-token-input" readonly class="token-input" placeholder="点击「生成」创建 Token">
                                        <button type="button" class="btn btn-primary" id="token-generate-btn" onclick="app.generateToken()" title="生成">
                                            <span class="material-icons">add</span>
                                            生成
                                        </button>
                                        <button type="button" class="btn btn-outline" id="token-reset-btn" onclick="app.resetToken()" title="重置" style="display:none">
                                            <span class="material-icons">refresh</span>
                                            重置
                                        </button>
                                        <button type="button" class="btn btn-outline" onclick="app.copyToken()" title="复制">
                                            <span class="material-icons">content_copy</span>
                                            复制
                                        </button>
                                        <button type="button" class="btn btn-outline" onclick="app.toggleTokenVisibility()" title="显示/隐藏">
                                            <span class="material-icons" id="token-visibility-icon">visibility</span>
                                        </button>
                                    </div>
                                    <p class="form-hint">Token 在设置中生成，永久有效。重置后旧 Token 失效。请勿泄露给他人。</p>
                                </div>
                            </div>
                        </div>
                        <div class="form-card">
                            <div class="card-header">
                                <h3>账本管理</h3>
                            </div>
                            <div class="card-body">
                                <form id="ledger-form" class="inline-form">
                                    <div class="form-group">
                                        <input type="text" id="new-ledger-name" placeholder="新账本名称">
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="new-ledger-desc" placeholder="账本描述">
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <span class="material-icons">add</span>
                                        添加账本
                                    </button>
                                </form>
                                <div id="ledgers-list" class="items-list"></div>
                            </div>
                        </div>
                        <div class="form-card">
                            <div class="card-header">
                                <h3>账户管理</h3>
                            </div>
                            <div class="card-body">
                                <form id="account-form" class="inline-form">
                                    <div class="form-group">
                                        <select id="account-ledger-select">
                                            <option value="">选择账本</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <input type="text" id="new-account-name" placeholder="账户名称">
                                    </div>
                                    <div class="form-group">
                                        <select id="new-account-type">
                                            <option value="股票">股票</option>
                                            <option value="基金">基金</option>
                                            <option value="债券">债券</option>
                                            <option value="期货">期货</option>
                                            <option value="现金">现金</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <select id="new-account-currency">
                                            <option value="CNY">CNY</option>
                                            <option value="USD">USD</option>
                                            <option value="HKD">HKD</option>
                                            <option value="EUR">EUR</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <span class="material-icons">add</span>
                                        添加账户
                                    </button>
                                </form>
                                <div id="accounts-list" class="items-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <div id="toast" class="toast"></div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">标题</h3>
                <button class="modal-close" onclick="app.closeModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <script src="/frontend/js/app.js"></script>
</body>
</html>
